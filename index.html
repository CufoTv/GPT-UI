<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT-5o ChatBot - Advanced Processing System</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        * {
            scroll-behavior: smooth;
        }
        
        .typing-animation {
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .message-bubble {
            animation: slideUp 0.3s ease forwards;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .processing-stage {
            transition: all 0.5s ease;
        }
        
        .processing-stage.active {
            background: linear-gradient(45deg, #10B981, #3B82F6);
            color: white;
        }
        
        .markov-progress {
            width: 0%;
            transition: width 0.8s ease;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .mobile-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .mobile-sidebar.open {
            transform: translateX(0);
        }
        
        .chat-message {
            max-width: calc(100% - 2rem);
        }
        
        @media (min-width: 768px) {
            .chat-message {
                max-width: 70%;
            }
        }
        
        .processing-indicator {
            background: linear-gradient(45deg, #EF4444, #F59E0B, #10B981, #3B82F6, #8B5CF6);
            background-size: 200% 200%;
            animation: gradientShift 2s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .json-indicator {
            position: fixed;
            top: 4px;
            right: 4px;
            z-index: 1000;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .mobile-optimized {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .content-area {
            flex: 1;
            overflow: visible;
        }
        
        @media print {
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white mobile-optimized">
    <!-- JSON Status Indicator -->
    <div class="json-indicator no-print">
        <i class="fas fa-database mr-1"></i>JSON Ready
    </div>

    <!-- Mobile Header -->
    <div class="md:hidden bg-gray-800 border-b border-gray-700 p-4 flex items-center justify-between no-print">
        <button id="mobileMenuBtn" class="text-white">
            <i class="fas fa-bars text-xl"></i>
        </button>
        <div class="flex items-center space-x-2">
            <div class="w-6 h-6 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                <i class="fas fa-robot text-white text-xs"></i>
            </div>
            <h1 class="text-lg font-bold">GPT-5o</h1>
        </div>
        <div id="mobileProcessingIndicator" class="w-6 h-6 rounded-full bg-gray-600"></div>
    </div>

    <div class="flex flex-1">
        <!-- Sidebar -->
        <div id="sidebar" class="w-80 md:w-72 lg:w-80 bg-gray-800 border-r border-gray-700 mobile-sidebar md:relative md:transform-none fixed inset-y-0 left-0 z-50 md:z-auto no-print">
            <!-- Logo -->
            <div class="p-4 md:p-6 border-b border-gray-700">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-lg flex items-center justify-center">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <h1 class="text-xl font-bold">GPT-5o</h1>
                    </div>
                    <button id="closeMobileMenu" class="md:hidden text-gray-400">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Processing Status -->
            <div class="p-4 border-b border-gray-700">
                <h3 class="text-sm font-semibold mb-3 text-gray-300">Processing Pipeline</h3>
                <div class="space-y-2" id="processingStages">
                    <div class="processing-stage p-2 rounded bg-gray-700 text-xs">
                        <i class="fas fa-search mr-2"></i>Stage 1: Query Analysis
                    </div>
                    <div class="processing-stage p-2 rounded bg-gray-700 text-xs">
                        <i class="fas fa-database mr-2"></i>Stage 2: JSON Matching
                    </div>
                    <div class="processing-stage p-2 rounded bg-gray-700 text-xs">
                        <i class="fas fa-brain mr-2"></i>Stage 3: Markov Chain
                    </div>
                    <div class="processing-stage p-2 rounded bg-gray-700 text-xs">
                        <i class="fas fa-cogs mr-2"></i>Stage 4: Response Generation
                    </div>
                    <div class="processing-stage p-2 rounded bg-gray-700 text-xs">
                        <i class="fas fa-check mr-2"></i>Stage 5: Output Refinement
                    </div>
                </div>
                <div class="mt-3">
                    <div class="bg-gray-700 rounded-full h-2">
                        <div id="markovProgress" class="markov-progress bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full"></div>
                    </div>
                    <div class="text-xs text-gray-400 mt-1" id="progressText">Ready</div>
                </div>
            </div>

            <!-- User Profile -->
            <div class="p-4 border-b border-gray-700">
                <div class="flex items-center space-x-3 mb-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white"></i>
                    </div>
                    <div>
                        <div class="font-semibold text-sm">User</div>
                        <div class="text-xs text-gray-400">Advanced Mode</div>
                    </div>
                </div>
                
                <!-- Model Selection -->
                <div class="mb-3">
                    <label class="block text-xs text-gray-400 mb-2">Model:</label>
                    <select id="modelSelect" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:border-blue-500 focus:outline-none text-sm">
                        <option value="gpt-5o-mini">GPT-5o Mini (Fast)</option>
                        <option value="gpt-5o" selected>GPT-5o Advanced (Smart)</option>
                    </select>
                </div>

                <!-- JSON Status -->
                <div class="mb-3">
                    <div class="flex justify-between items-center text-xs">
                        <span class="text-gray-400">JSON Database:</span>
                        <span id="jsonStatus" class="text-green-400">
                            <i class="fas fa-check-circle mr-1"></i>Connected
                        </span>
                    </div>
                    <div class="flex justify-between items-center text-xs mt-1">
                        <span class="text-gray-400">Records:</span>
                        <span id="recordCount" class="text-blue-400">1,247</span>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="p-4">
                <h3 class="text-xs font-semibold mb-3 text-gray-400">Session Stats</h3>
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Messages:</span>
                        <span id="messageCount">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Accuracy:</span>
                        <span id="accuracyRate" class="text-green-400">98.5%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Avg Response:</span>
                        <span id="avgResponse" class="text-blue-400">2.3s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="flex-1 flex flex-col content-area">
            <!-- Chat Header -->
            <div class="bg-gray-800 border-b border-gray-700 p-3 md:p-4 no-print">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-robot text-white text-sm"></i>
                        </div>
                        <div>
                            <div class="font-semibold text-sm md:text-base">GPT-5o Assistant</div>
                            <div class="text-xs text-gray-400">Advanced AI with Markov Processing</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div id="processingIndicator" class="w-3 h-3 rounded-full bg-gray-600"></div>
                        <button id="clearChatBtn" class="bg-red-600 hover:bg-red-700 px-2 py-1 md:px-3 md:py-2 rounded text-xs md:text-sm transition-colors">
                            <i class="fas fa-trash mr-1"></i>Clear
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div id="chatContainer" class="flex-1 p-3 md:p-6 space-y-4 overflow-visible">
                <div id="welcomeMessage" class="text-center py-8 md:py-12">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-robot text-white text-lg md:text-2xl"></i>
                    </div>
                    <h2 class="text-xl md:text-2xl font-bold mb-2">Welcome to GPT-5o Advanced</h2>
                    <p class="text-gray-400 text-sm md:text-base mb-4">AI-powered assistant with 5-stage Markov chain processing</p>
                    <div class="flex flex-wrap justify-center gap-2 text-xs">
                        <span class="bg-green-600 px-2 py-1 rounded">JSON Database</span>
                        <span class="bg-blue-600 px-2 py-1 rounded">Markov Chain</span>
                        <span class="bg-purple-600 px-2 py-1 rounded">Smart Matching</span>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="bg-gray-800 border-t border-gray-700 p-3 md:p-4 no-print">
                <div class="flex items-end space-x-2 md:space-x-3">
                    <div class="flex-1 relative">
                        <textarea id="chatInput" 
                                placeholder="Ask me anything..." 
                                class="w-full p-3 pr-12 bg-gray-700 rounded-lg border border-gray-600 focus:border-blue-500 focus:outline-none resize-none text-sm md:text-base"
                                rows="1"></textarea>
                        <button id="sendBtn" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-blue-600 hover:bg-blue-700 w-8 h-8 rounded-full flex items-center justify-center transition-colors">
                            <i class="fas fa-paper-plane text-sm"></i>
                        </button>
                    </div>
                </div>
                <div class="flex justify-between text-xs text-gray-400 mt-2">
                    <span>Enhanced with JSON knowledge base</span>
                    <span id="inputCounter">0/1000</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden no-print"></div>

    <script>
        // Mock GPT-5o JSON Database
        const gptDatabase = {
            "version": "5.0.1",
            "total_records": 1247,
            "categories": {
                "general": [
                    {
                        "id": 1,
                        "question": "what is artificial intelligence",
                        "answer": "Artificial Intelligence (AI) is a branch of computer science that aims to create intelligent machines that work and react like humans. It involves machine learning, natural language processing, computer vision, and robotics to solve complex problems and automate tasks.",
                        "confidence": 0.95,
                        "keywords": ["ai", "artificial", "intelligence", "machine", "learning", "computer", "science"],
                        "related_topics": ["machine learning", "deep learning", "neural networks"]
                    },
                    {
                        "id": 2,
                        "question": "how does machine learning work",
                        "answer": "Machine learning is a subset of AI that enables computers to learn and make decisions from data without being explicitly programmed for every scenario. It uses algorithms to identify patterns in data, make predictions, and improve performance over time through experience.",
                        "confidence": 0.92,
                        "keywords": ["machine", "learning", "algorithm", "data", "pattern", "prediction"],
                        "related_topics": ["supervised learning", "unsupervised learning", "reinforcement learning"]
                    },
                    {
                        "id": 3,
                        "question": "what is deep learning",
                        "answer": "Deep learning is a subset of machine learning that uses artificial neural networks with multiple layers to model and understand complex patterns in data. It's particularly effective for tasks like image recognition, natural language processing, and speech recognition.",
                        "confidence": 0.94,
                        "keywords": ["deep", "learning", "neural", "networks", "layers", "patterns"],
                        "related_topics": ["neural networks", "backpropagation", "convolutional networks"]
                    }
                ],
                "technology": [
                    {
                        "id": 4,
                        "question": "what is cloud computing",
                        "answer": "Cloud computing is the delivery of computing services including servers, storage, databases, networking, software, analytics, and intelligence over the Internet ('the cloud') to offer faster innovation, flexible resources, and economies of scale.",
                        "confidence": 0.96,
                        "keywords": ["cloud", "computing", "internet", "services", "storage", "server"],
                        "related_topics": ["AWS", "Azure", "Google Cloud", "SaaS", "IaaS", "PaaS"]
                    },
                    {
                        "id": 5,
                        "question": "what is blockchain technology",
                        "answer": "Blockchain is a distributed ledger technology that maintains a continuously growing list of records, called blocks, which are linked and secured using cryptography. It's the technology behind cryptocurrencies like Bitcoin and has applications in supply chain, healthcare, and more.",
                        "confidence": 0.93,
                        "keywords": ["blockchain", "ledger", "cryptocurrency", "bitcoin", "security", "distributed"],
                        "related_topics": ["cryptocurrency", "smart contracts", "decentralized finance"]
                    }
                ],
                "science": [
                    {
                        "id": 6,
                        "question": "what is quantum computing",
                        "answer": "Quantum computing is a type of computation that harnesses the phenomena of quantum mechanics to process information. Unlike classical computers that use bits (0 or 1), quantum computers use quantum bits or qubits that can exist in multiple states simultaneously.",
                        "confidence": 0.91,
                        "keywords": ["quantum", "computing", "qubits", "mechanics", "superposition", "bits"],
                        "related_topics": ["quantum mechanics", "superposition", "entanglement"]
                    }
                ]
            }
        };

        // Application state
        let chatHistory = [];
        let isProcessing = false;
        let messageCounter = 0;
        let processingStartTime = 0;

        // DOM elements
        const sidebar = document.getElementById('sidebar');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const closeMobileMenu = document.getElementById('closeMobileMenu');
        const chatContainer = document.getElementById('chatContainer');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const processingStages = document.querySelectorAll('.processing-stage');
        const markovProgress = document.getElementById('markovProgress');
        const progressText = document.getElementById('progressText');
        const processingIndicator = document.getElementById('processingIndicator');
        const mobileProcessingIndicator = document.getElementById('mobileProcessingIndicator');

        // Initialize application
        function init() {
            setupEventListeners();
            setupChatInput();
            updateStats();
            
            // Simulate JSON loading
            setTimeout(() => {
                document.getElementById('jsonStatus').innerHTML = '<i class="fas fa-check-circle mr-1"></i>Connected';
            }, 1000);
        }

        function setupEventListeners() {
            // Mobile menu
            mobileMenuBtn.addEventListener('click', () => {
                sidebar.classList.add('open');
                mobileOverlay.classList.remove('hidden');
            });

            closeMobileMenu.addEventListener('click', closeMobileMenu_);
            mobileOverlay.addEventListener('click', closeMobileMenu_);

            // Chat
            sendBtn.addEventListener('click', handleSendMessage);
            document.getElementById('clearChatBtn').addEventListener('click', clearChat);
        }

        function closeMobileMenu_() {
            sidebar.classList.remove('open');
            mobileOverlay.classList.add('hidden');
        }

        function setupChatInput() {
            const input = chatInput;
            const counter = document.getElementById('inputCounter');
            const maxLength = 1000;

            input.addEventListener('input', () => {
                const length = input.value.length;
                counter.textContent = `${length}/${maxLength}`;
                
                // Auto-resize textarea
                input.style.height = 'auto';
                input.style.height = Math.min(input.scrollHeight, 120) + 'px';
            });

            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });
        }

        async function handleSendMessage() {
            if (isProcessing) return;

            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message
            addMessage(message, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';
            document.getElementById('inputCounter').textContent = '0/1000';

            // Close mobile menu if open
            closeMobileMenu_();

            // Process message through 5-stage pipeline
            await processMessage(message);
        }

        function addMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'message-bubble', 'chat-message');
            
            if (sender === 'user') {
                messageDiv.classList.add('justify-end', 'ml-auto');
                messageDiv.innerHTML = `
                    <div class="flex items-end space-x-2">
                        <div class="bg-blue-600 text-white p-3 rounded-lg rounded-br-none max-w-full break-words">
                            ${message}
                        </div>
                        <div class="w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-user text-white text-xs"></i>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.classList.add('justify-start', 'mr-auto');
                messageDiv.innerHTML = `
                    <div class="flex items-end space-x-2">
                        <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-robot text-white text-xs"></i>
                        </div>
                        <div class="bg-gray-700 text-white p-3 rounded-lg rounded-bl-none max-w-full break-words">
                            <div class="typing-text">${message}</div>
                        </div>
                    </div>
                `;
            }

            // Remove welcome message if it exists
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.remove();
            }

            chatContainer.appendChild(messageDiv);
            
            // Scroll to bottom on mobile
            if (window.innerWidth < 768) {
                setTimeout(() => {
                    messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }, 100);
            }

            // Save to history
            chatHistory.push({ message, sender, timestamp: Date.now() });
            messageCounter++;
            updateStats();
        }

        async function processMessage(userMessage) {
            isProcessing = true;
            processingStartTime = Date.now();
            updateProcessingIndicators(true);

            // Stage 1: Query Analysis
            await updateStage(0, "Analyzing query structure and intent...");
            await sleep(800);

            // Stage 2: JSON Matching
            await updateStage(1, "Searching JSON database for matches...");
            const matches = await searchDatabase(userMessage);
            await sleep(1000);

            // Stage 3: Markov Chain Processing
            await updateStage(2, "Processing with Markov chain algorithm...");
            const markovResult = await processMarkovChain(matches, userMessage);
            await sleep(1200);

            // Stage 4: Response Generation
            await updateStage(3, "Generating optimized response...");
            const response = await generateResponse(markovResult, userMessage);
            await sleep(600);

            // Stage 5: Output Refinement
            await updateStage(4, "Refining and finalizing output...");
            const finalResponse = await refineResponse(response);
            await sleep(500);

            // Complete processing
            resetProcessingStages();
            updateProcessingIndicators(false);
            
            // Add bot response with typing effect
            await addBotMessageWithTyping(finalResponse);
            
            isProcessing = false;
            updateStats();
        }

        async function updateStage(stageIndex, message) {
            // Reset all stages
            processingStages.forEach((stage, index) => {
                if (index <= stageIndex) {
                    stage.classList.add('active');
                } else {
                    stage.classList.remove('active');
                }
            });

            // Update progress
            const progress = ((stageIndex + 1) / 5) * 100;
            markovProgress.style.width = `${progress}%`;
            progressText.textContent = message;
        }

        function resetProcessingStages() {
            processingStages.forEach(stage => {
                stage.classList.remove('active');
            });
            markovProgress.style.width = '0%';
            progressText.textContent = 'Complete';
        }

        function updateProcessingIndicators(isActive) {
            const indicators = [processingIndicator, mobileProcessingIndicator];
            indicators.forEach(indicator => {
                if (isActive) {
                    indicator.classList.remove('bg-gray-600');
                    indicator.classList.add('processing-indicator');
                } else {
                    indicator.classList.add('bg-gray-600');
                    indicator.classList.remove('processing-indicator');
                }
            });
        }

        async function searchDatabase(query) {
            const queryLower = query.toLowerCase();
            const allRecords = Object.values(gptDatabase.categories).flat();
            const matches = [];

            allRecords.forEach(record => {
                let score = 0;
                
                // Check exact question match
                if (record.question.toLowerCase().includes(queryLower)) {
                    score += 10;
                }

                // Check keyword matches
                record.keywords.forEach(keyword => {
                    if (queryLower.includes(keyword)) {
                        score += 2;
                    }
                });

                // Check partial matches
                const queryWords = queryLower.split(' ');
                queryWords.forEach(word => {
                    if (word.length > 2 && record.answer.toLowerCase().includes(word)) {
                        score += 1;
                    }
                });

                if (score > 0) {
                    matches.push({ ...record, score });
                }
            });

            return matches.sort((a, b) => b.score - a.score).slice(0, 10);
        }

        async function processMarkovChain(matches, userQuery) {
            if (matches.length === 0) {
                return {
                    text: "I don't have specific information about that in my knowledge base.",
                    confidence: 0.1
                };
            }

            // Get top matches for Markov processing
            const topMatches = matches.filter(match => match.score >= 8);
            
            if (topMatches.length > 0) {
                // Use highest scoring match for 10/10 matches
                const bestMatch = topMatches[0];
                return {
                    text: bestMatch.answer,
                    confidence: bestMatch.confidence,
                    matchType: "exact",
                    relatedTopics: bestMatch.related_topics
                };
            }

            // Use Markov chain for 8/10 matches
            const goodMatches = matches.filter(match => match.score >= 6);
            if (goodMatches.length > 0) {
                const combinedText = goodMatches.map(match => match.answer).join(' ');
                const markovResponse = generateMarkovResponse(combinedText, userQuery);
                
                return {
                    text: markovResponse,
                    confidence: 0.75,
                    matchType: "markov",
                    sourceCount: goodMatches.length
                };
            }

            // Fallback for lower matches
            return {
                text: "I found some related information, but I'd need more context to provide a comprehensive answer.",
                confidence: 0.4,
                matchType: "fallback"
            };
        }

        function generateMarkovResponse(text, query) {
            // Simple Markov chain implementation
            const words = text.toLowerCase().split(/\s+/);
            const wordMap = {};
            
            // Build word transitions
            for (let i = 0; i < words.length - 1; i++) {
                const currentWord = words[i];
                const nextWord = words[i + 1];
                
                if (!wordMap[currentWord]) {
                    wordMap[currentWord] = [];
                }
                wordMap[currentWord].push(nextWord);
            }

            // Generate response starting with query-related word
            const queryWords = query.toLowerCase().split(/\s+/);
            let startWord = null;
            
            for (const word of queryWords) {
                if (wordMap[word]) {
                    startWord = word;
                    break;
                }
            }

            if (!startWord) {
                startWord = Object.keys(wordMap)[Math.floor(Math.random() * Object.keys(wordMap).length)];
            }

            // Generate sentence
            const response = [];
            let currentWord = startWord;
            const maxWords = 50;

            for (let i = 0; i < maxWords && currentWord; i++) {
                response.push(currentWord);
                
                if (wordMap[currentWord] && wordMap[currentWord].length > 0) {
                    const nextOptions = wordMap[currentWord];
                    currentWord = nextOptions[Math.floor(Math.random() * nextOptions.length)];
                } else {
                    break;
                }

                // Stop at sentence endings
                if (currentWord && (currentWord.endsWith('.') || currentWord.endsWith('!') || currentWord.endsWith('?'))) {
                    response.push(currentWord);
                    break;
                }
            }

            return response.join(' ').replace(/^\w/, c => c.toUpperCase());
        }

        async function generateResponse(markovResult, userQuery) {
            let response = markovResult.text;

            // Add context based on match type
            if (markovResult.matchType === "exact") {
                response = `${response}`;
                if (markovResult.relatedTopics && markovResult.relatedTopics.length > 0) {
                    response += `\n\nRelated topics you might be interested in: ${markovResult.relatedTopics.join(', ')}.`;
                }
            } else if (markovResult.matchType === "markov") {
                response = `Based on my knowledge base analysis: ${response}`;
                response += `\n\n*This response was generated using Markov chain processing from ${markovResult.sourceCount} related sources.*`;
            }

            return response;
        }

        async function refineResponse(response) {
            // Add final touches and formatting
            return response.trim();
        }

        async function addBotMessageWithTyping(message) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'justify-start', 'message-bubble', 'chat-message', 'mr-auto');
            messageDiv.innerHTML = `
                <div class="flex items-end space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white text-xs"></i>
                    </div>
                    <div class="bg-gray-700 text-white p-3 rounded-lg rounded-bl-none max-w-full break-words">
                        <div class="typing-text"></div>
                    </div>
                </div>
            `;

            chatContainer.appendChild(messageDiv);
            
            // Type message
            const typingElement = messageDiv.querySelector('.typing-text');
            await typeMessage(typingElement, message);

            // Save to history
            chatHistory.push({ message, sender: 'bot', timestamp: Date.now() });
            
            // Scroll to bottom on mobile
            if (window.innerWidth < 768) {
                setTimeout(() => {
                    messageDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }, 100);
            }
        }

        async function typeMessage(element, message) {
            const words = message.split(' ');
            let currentText = '';
            
            for (let i = 0; i < words.length; i++) {
                currentText += (i > 0 ? ' ' : '') + words[i];
                element.textContent = currentText;
                
                // Add slight delay between words
                await sleep(50 + Math.random() * 100);
            }
        }

        function clearChat() {
            chatHistory = [];
            messageCounter = 0;
            chatContainer.innerHTML = `
                <div id="welcomeMessage" class="text-center py-8 md:py-12">
                    <div class="w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <i class="fas fa-robot text-white text-lg md:text-2xl"></i>
                    </div>
                    <h2 class="text-xl md:text-2xl font-bold mb-2">Welcome to GPT-5o Advanced</h2>
                    <p class="text-gray-400 text-sm md:text-base mb-4">AI-powered assistant with 5-stage Markov chain processing</p>
                    <div class="flex flex-wrap justify-center gap-2 text-xs">
                        <span class="bg-green-600 px-2 py-1 rounded">JSON Database</span>
                        <span class="bg-blue-600 px-2 py-1 rounded">Markov Chain</span>
                        <span class="bg-purple-600 px-2 py-1 rounded">Smart Matching</span>
                    </div>
                </div>
            `;
            updateStats();
        }

        function updateStats() {
            document.getElementById('messageCount').textContent = messageCounter;
            
            // Update response time
            if (processingStartTime > 0) {
                const responseTime = ((Date.now() - processingStartTime) / 1000).toFixed(1);
                document.getElementById('avgResponse').textContent = `${responseTime}s`;
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.innerWidth >= 768) {
                closeMobileMenu_();
            }
        });
    </script>
</body>
</html>
